<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SidxSuri - Connect With Me</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TKWXVL5930"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-TKWXVL5930', {'anonymize_ip': true});
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBuzAqahAhfKEeDSq_ap_1M5GkxlkMXM3o",
            authDomain: "sidxsuri1986.firebaseapp.com",
            databaseURL: "https://sidxsuri1986-default-rtdb.firebaseio.com",
            projectId: "sidxsuri1986",
            storageBucket: "sidxsuri1986.firebasestorage.app",
            messagingSenderId: "65985778635",
            appId: "1:65985778635:web:c78b95e54f8eaa4917dc4e",
            measurementId: "G-TKWXVL5930"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        async function trackVisitors() {
            try {
                const response = await fetch("https://ip-api.com/json/");
                const data = await response.json();

                if (data.status !== "success") {
                    throw new Error("Failed to fetch IP data");
                }

                const userIP = data.query;
                const country = data.country;
                const state = data.regionName;

                const visitorRef = doc(db, "visitorRecords", userIP);
                const visitorSnap = await getDoc(visitorRef);
                const countRef = doc(db, "visitorCount", "counter");
                const countSnap = await getDoc(countRef);

                let uniqueVisitors = countSnap.exists() ? countSnap.data().unique || 0 : 0;
                let totalVisits = countSnap.exists() ? countSnap.data().total || 0 : 0;

                if (!visitorSnap.exists()) {
                    await setDoc(visitorRef, { visitedAt: new Date(), country: country, state: state });
                    uniqueVisitors++;
                }

                totalVisits++;

                await setDoc(countRef, { unique: uniqueVisitors, total: totalVisits }, { merge: true });

                document.getElementById("unique-visitors").innerText = uniqueVisitors;
                document.getElementById("total-visits").innerText = totalVisits;

                updateLocationList();
            } catch (error) {
                console.error("Error tracking visitors:", error);
                document.getElementById("unique-visitors").innerText = "Error";
                document.getElementById("total-visits").innerText = "Error";
            }
        }

        async function updateLocationList() {
            const locations = new Set();
            const querySnapshot = await getDocs(collection(db, "visitorRecords"));
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                locations.add(`${data.state}, ${data.country}`);
            });

            document.getElementById("visitor-locations").innerText = Array.from(locations).join(" | ");
        }

        trackVisitors();
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: black;
            color: white;
            text-align: center;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 50px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            margin: auto;
        }
    </style>
</head>
<body>
    <div class="container p-4">
        <h1 class="mb-4">Connect With Me</h1>
        <p>Unique Visitors: <span id="unique-visitors">Loading...</span> | Total Visits: <span id="total-visits">Loading...</span></p>
        <p>Visitors from: <span id="visitor-locations">Loading...</span></p>
    </div>
</body>
</html>
